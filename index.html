<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8" />
<title>Quick File Sharing</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body{
  margin:0;background:#000;color:#00ff99;
  font-family:"Share Tech Mono",monospace;padding:20px;
}
.box{
  max-width:600px;margin:auto;border:1px solid #00ff99;
  padding:18px;border-radius:10px;
  background:rgba(0,40,0,.4);
}

/* STATUS */
.status-center{text-align:center;margin-bottom:14px;}
.status-pill{
  display:inline-flex;align-items:center;gap:8px;
  background:#002a00;border:1px solid #00ff99;
  padding:6px 12px;border-radius:999px;
}
.dot{width:10px;height:10px;border-radius:50%;}
.connecting{background:yellow;}
.online{background:#00ff99;box-shadow:0 0 10px #00ff99;}
.offline{background:red;}
.spinner{
  width:14px;height:14px;border:2px solid rgba(0,255,153,.3);
  border-top:2px solid #00ff99;border-radius:50%;
  animation:spin .8s linear infinite;display:none;
}
@keyframes spin{to{transform:rotate(360deg);}}

/* FILE PICKER */
.file-picker{
  margin-top:14px;border:1px dashed #00ff99;
  padding:18px;border-radius:10px;
  background:rgba(0,20,0,.4);text-align:center;
}
.file-picker input{display:none;}

/* ðŸ”§ Smaller + less glow */
.choose-btn{
  display:inline-block;margin-bottom:10px;
  padding:8px 18px;                 /* smaller */
  border-radius:999px;
  background:linear-gradient(135deg,#00ff99,#00cc66);
  color:#001a00;font-weight:bold;cursor:pointer;
  box-shadow:0 0 6px rgba(0,255,153,.35); /* less glow */
}
.file-info{font-size:.85rem;color:#9dffcf;}

/* ðŸ”§ Bigger Upload button */
button#uploadBtn{
  margin-top:14px;
  padding:12px 28px;               /* bigger */
  font-size:1rem;
  background:#00ff99;color:#001a00;
  font-weight:bold;border-radius:999px;
  border:0;cursor:pointer;
}

/* UPLOAD PROGRESS */
.upload-progress{
  margin-top:10px;font-size:.85rem;display:none;
}
.progress-bar{
  width:100%;height:6px;background:#001a00;
  border-radius:999px;overflow:hidden;
  border:1px solid #00ff99;margin-top:4px;
}
#progressFill{
  height:100%;width:0%;
  background:#00ff99;
  box-shadow:0 0 10px #00ff99;
  transition:width .1s linear;
}

/* FILE LIST */
.file-item{
  border:1px solid #006600;padding:10px;
  border-radius:8px;margin-bottom:10px;
}
.file-actions{
  margin-top:6px;display:flex;gap:8px;flex-wrap:wrap;
}

/* ðŸ”§ Download text perfectly centered */
.btn-download{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:6px 14px;
  border-radius:999px;
  background:linear-gradient(135deg,#00ff99,#00cc66);
  color:#001a00;font-weight:bold;
  text-decoration:none;
  line-height:1;                   /* alignment fix */
}

.btn-delete{
  padding:6px 12px;border-radius:999px;
  border:1px solid #ff4d4d;
  background:#330000;color:#ffb3b3;
  cursor:pointer;
}

/* POPUP */
.popup-overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.8);
  display:none;align-items:center;justify-content:center;
  z-index:9999;
}
.popup{
  background:#001a00;border:1px solid #00ff99;
  padding:18px;border-radius:10px;
  text-align:center;box-shadow:0 0 20px #00ff99;
}
</style>
</head>

<body>

<div class="box">
<h2>Quick File Sharing</h2>
<p>Uploaded files auto-delete after 5 minutes.</p>

<div class="status-center">
  <div class="status-pill">
    <div id="serverDot" class="dot connecting"></div>
    <div id="serverSpinner" class="spinner"></div>
    <span id="serverText">Connecting to serverâ€¦</span>
  </div>
</div>

<div class="file-picker">
  <label class="choose-btn">
    ðŸ“‚ Choose Files
    <input type="file" id="fileInput" multiple />
  </label>
  <div id="fileInfo" class="file-info">No file selected</div>
</div>

<button id="uploadBtn">Upload Files</button>

<div class="upload-progress" id="uploadProgress">
  <span id="progressText">Uploading: 0%</span>
  <div class="progress-bar">
    <div id="progressFill"></div>
  </div>
</div>

<h3>Active Files:</h3>
<div id="fileList"></div>
</div>

<!-- POPUP -->
<div class="popup-overlay" id="popup">
  <div class="popup">
    <p id="popupText"></p>
  </div>
</div>

<p style="text-align:center;margin-top:25px;color:#00ffcc;">
Powered by <b>BAPON BARMON</b>
</p>

<script>
const API_BASE="https://file-transfer-backend-ifcf.onrender.com";
const serverDot=document.getElementById("serverDot");
const serverSpinner=document.getElementById("serverSpinner");
const serverText=document.getElementById("serverText");
const fileInput=document.getElementById("fileInput");
const fileInfo=document.getElementById("fileInfo");
const fileList=document.getElementById("fileList");
const uploadProgress=document.getElementById("uploadProgress");
const progressFill=document.getElementById("progressFill");
const progressText=document.getElementById("progressText");

let filesState=[],popupTimer=null;

/* FILE INFO */
fileInput.onchange=()=>{
  if(!fileInput.files.length) fileInfo.textContent="No file selected";
  else if(fileInput.files.length===1) fileInfo.textContent=fileInput.files[0].name;
  else fileInfo.textContent=fileInput.files.length+" files selected";
};

/* STATUS */
function setServerStatus(mode){
  serverDot.className="dot "+mode;
  serverSpinner.style.display=mode==="connecting"?"inline-block":"none";
  serverText.textContent=
    mode==="online"?"Server Connected":
    mode==="offline"?"Server Offline / Sleeping":
    "Connecting to serverâ€¦";
}

async function checkServer(){
  setServerStatus("connecting");
  try{
    const r=await fetch(API_BASE+"/");
    if(!r.ok) throw 0;
    setServerStatus("online");
  }catch{ setServerStatus("offline"); }
}

/* POPUP â€“ 1.5s AUTO CLOSE */
function showPopup(msg){
  const p=document.getElementById("popup");
  document.getElementById("popupText").textContent=msg;
  p.style.display="flex";
  if(popupTimer) clearTimeout(popupTimer);
  popupTimer=setTimeout(()=>p.style.display="none",1500); // ðŸ”¥ 1.5s
}

/* UPLOAD WITH PROGRESS */
document.getElementById("uploadBtn").onclick=()=>{
  if(!fileInput.files.length){ showPopup("âš  Select file first"); return; }

  const fd=new FormData();
  [...fileInput.files].forEach(f=>fd.append("files",f));

  uploadProgress.style.display="block";
  progressFill.style.width="0%";
  progressText.textContent="Uploading: 0%";

  const xhr=new XMLHttpRequest();
  xhr.open("POST",API_BASE+"/upload");

  xhr.upload.onprogress=e=>{
    if(e.lengthComputable){
      const p=Math.round((e.loaded*100)/e.total);
      progressFill.style.width=p+"%";
      progressText.textContent="Uploading: "+p+"%";
    }
  };

  xhr.onload=()=>{
    uploadProgress.style.display="none";
    showPopup("âœ… Upload Successful");
    fileInput.value="";
    fileInfo.textContent="No file selected";
    loadFiles();
  };

  xhr.onerror=()=>{
    uploadProgress.style.display="none";
    showPopup("âŒ Upload Failed");
  };

  xhr.send(fd);
};

/* LOAD FILES */
async function loadFiles(){
  try{
    const r=await fetch(API_BASE+"/files");
    const d=await r.json();
    filesState=d.files.map(f=>({...f,start:Date.now()}));
    renderFiles();
  }catch{ setServerStatus("offline"); }
}

/* DELETE */
async function deleteFile(id){
  showPopup("ðŸ—‘ Deleting file...");
  await fetch(API_BASE+"/files/"+id,{method:"DELETE"});
  loadFiles();
}

/* RENDER */
function renderFiles(){
  fileList.innerHTML="";
  if(!filesState.length){
    fileList.innerHTML="<p>No active files.</p>";
    return;
  }
  filesState.forEach(f=>{
    const sec=Math.max(0,Math.floor((f.remainingMs-(Date.now()-f.start))/1000));
    fileList.innerHTML+=`
      <div class="file-item">
        <b>${f.originalName}</b><br>
        Expires in ${Math.floor(sec/60)}:${String(sec%60).padStart(2,"0")}
        <div class="file-actions">
          <a class="btn-download" href="${API_BASE}/download/${f.id}" target="_blank">â¬‡ Download</a>
          <button class="btn-delete" onclick="deleteFile('${f.id}')">ðŸ—‘ Delete</button>
        </div>
      </div>`;
  });
}

setInterval(renderFiles,1000);
setInterval(loadFiles,5000);
checkServer();
loadFiles();
</script>

</body>
</html>
